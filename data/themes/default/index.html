<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<title>Performous web frontend</title>

	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css">
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
</head>
<body>
<style>
.ui-page {background: #feffff; /* Old browsers */
background: -moz-linear-gradient(-45deg, #feffff 0%, #ddf1f9 35%, #a8aac1 100%); /* FF3.6+ */
background: -webkit-gradient(linear, left top, right bottom, color-stop(0%,#feffff), color-stop(35%,#ddf1f9), color-stop(100%,#a8aac1)); /* Chrome,Safari4+ */
background: -webkit-linear-gradient(-45deg, #feffff 0%,#ddf1f9 35%,#a8aac1 100%); /* Chrome10+,Safari5.1+ */
background: -o-linear-gradient(-45deg, #feffff 0%,#ddf1f9 35%,#a8aac1 100%); /* Opera 11.10+ */
background: -ms-linear-gradient(-45deg, #feffff 0%,#ddf1f9 35%,#a8aac1 100%); /* IE10+ */
background: linear-gradient(135deg, #feffff 0%,#ddf1f9 35%,#a8aac1 100%); /* W3C */
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#feffff', endColorstr='#a8aac1',GradientType=1 ); /* IE6-9 fallback on horizontal gradient */
}
</style>
<!-- Home -->
<div data-role="page" id="page1">
	<div data-theme="a" data-role="header">
		<h3>Performous web frontend</h3>
		<div data-role="navbar" data-iconpos="top">
			<ul>
				<li><a href="#page1" data-transition="flow" data-theme="" data-icon="info" data-iconpos="top" class="ui-btn-active ui-state-persist">
					View database
				</a></li>
				<li><a href="#page2" data-transition="flow" data-theme="" data-icon="grid" data-iconpos="top">
					View playlist
				</a></li>
				<li><a href="#page3" data-transition="flow" data-theme="" data-icon="search" data-iconpos="top">
					Search & Add
				</a>
				</li>
			</ul>
		</div>
	</div>
	<div data-role="content">
	<div class="ui-grid-a">
		<div class="ui-block-a" style="width:70%">
		<form id="radioButtonForm">
		 <fieldset data-role="controlgroup" data-type="horizontal">
        <legend>Sort by:</legend>
        <input name="radio-choice-Sort" id="radio-choice-Artist" value="1" checked="checked" type="radio">
        <label for="radio-choice-Artist">Artist</label>
        <input name="radio-choice-Sort" id="radio-choice-Title" value="2" type="radio">
        <label for="radio-choice-Title">Title</label>
        <input name="radio-choice-Sort" id="radio-choice-Language" value="3" type="radio">
        <label for="radio-choice-Language">Language</label>
        <input name="radio-choice-Sort" id="radio-choice-Edition" value="4" type="radio">
        <label for="radio-choice-Edition">Edition</label>
        <input name="radio-choice-Sort" id="radio-choice-Creator" value="5" type="radio">
        <label for="radio-choice-Creator">Creator</label>
    </fieldset>
    </form>
    </div> <div class="ui-block-b" style="width:30%">
    		<div data-role="fieldcontain">
			<label for="flipsortmode">Sort order:</label>	
			<select name="flipsortmode" id="flipsortmode" data-role="slider" data-mini="false">
				<option value="off">Normal</option>
				<option value="on">Inverted</option>
			</select>
			</div>
		</div>
	</div>
			<a id="databaseRefreshButton" data-role="button" href="#page1" data-icon="refresh">
			Refresh database
		</a>
		<table id="songtable" border="1">
			<tr>
				<th>Artist</th>
				<th>Title</th>
				<th>Language</th>
				<th>Edition</th>
				<th>Creator</th>
			</tr>
		</table>
	</div>
</div>

<!-- Playlist -->
<div data-role="page" id="page2">
	<div data-theme="a" data-role="header">
		<h3>Performous web frontend</h3>
		<div data-role="navbar" data-iconpos="top">
			<ul>
				<li><a href="#page1" data-transition="flow" data-theme="" data-icon="info" data-iconpos="top" data-direction="reverse">
					View database
				</a></li>
				<li><a href="#page2" data-transition="flow" data-theme="" data-icon="grid" data-iconpos="top" class="ui-btn-active ui-state-persist">
					View playlist
				</a></li>
				<li><a href="#page3" data-transition="flow" data-theme="" data-icon="search" data-iconpos="top">
					Search & Add
				</a>
				</li>
			</ul>
		</div>
	</div>
	<div data-role="content">
		<ul data-role="listview" id="playListView" data-divider-theme="b">
			<li data-role="list-divider" role="heading">
				Upcoming songs:
			</li>
		</ul>
		<br> <br>

		<div class="ui-block-d1">
			<a id="playlistRefreshButton" data-role="button" href="#page2" data-icon="refresh" data-iconpos="top">
				Refresh Playlist
			</a>
		</div>
		<br>
		<div data-role="fieldcontain">
			<label for="flipupdate">Update every 10 sec.</label>
			<select name="flipupdate" id="flipupdate" data-role="slider" data-mini="false">
				<option value="off">No</option>
				<option value="on">Yes</option>
			</select>
		</div>
		<small>Web interface by Niek Nooijens, for full credits regarding Performous see /docs/Authors.txt</small>
	</div>
</div>
<!-- Search system -->
<div data-role="page" id="page3">
	<div data-theme="a" data-role="header">
		<h3>Performous web frontend</h3>
		<div data-role="navbar" data-iconpos="top">
			<ul>
				<li><a href="#page1" data-transition="flow" data-theme="" data-icon="info" data-iconpos="top" data-direction="reverse">
					View database
				</a></li>
				<li><a href="#page2" data-transition="flow" data-theme="" data-icon="grid" data-iconpos="top" data-direction="reverse">
					View playlist
				</a></li>
				<li><a href="#page3" data-transition="flip" data-theme="" data-icon="search" data-iconpos="top" class="ui-btn-active ui-state-persist">
					Search & Add
				</a>
				</li>
			</ul>
		</div>
	</div>
	<div data-role="content">
	<div class="ui-grid-a">
	    <div class="ui-block-a">
		</br>
	        <ul id="autocomplete" data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="Search for songs" data-filter-theme="d"></ul>
            </div>
            <div class="ui-block-b">
		<a id="databaseSearchButton" data-role="button" href="#page3" data-icon="search">Search</a> 
            </div>
	</div>
	<br> <br>
	<ul data-role="listview" id="searchResultsViewer" data-divider-theme="b">
		<li data-role="list-divider" role="heading">
			Available songs:
		</li>
	</ul>
</div>
</div>
<!-- dialog -->
<div data-role="page" id="page4">
	<div data-role="content">
		<div id="songinfo">
		</div>
	</div>
</div>

<script>	
	var update = false;
	var invertedsort = false;
	var database = {};
	var songlist = {};
	


	<!-- Home -->

	$("#databaseRefreshButton").bind ("click", function(event) {
		$.get("api/getDataBase.json", function(data) {
			database = JSON.parse(data);
			
			var s = $('input[name=radio-choice-Sort]:checked', '#radioButtonForm').val();
			switch(s) {
				case '1':
				database = sortByKey(database, 'Title');
				database = sortByKey(database, 'Artist');
				break;
				case '2':
				database = sortByKey(database, 'Artist');
				database = sortByKey(database, 'Title');
				break;
				case '3':
				database = sortByKey(database, 'Artist');
				database = sortByKey(database, 'Language');
				break;
				case '4':
				database = sortByKey(database, 'Artist');
				database = sortByKey(database, 'Edition');
				break;
				case '5':
				database = sortByKey(database, 'Artist');
				database = sortByKey(database, 'Creator');
				break;
			}
			    var table = document.getElementById("songtable");
			    for(var i = table.rows.length -1; i > 0; i--) {
					table.deleteRow(i);
					}
			    if(invertedsort) {
			    	for (var i = database.length - 1; i>=0; i--) {
			    		$("#songtable").last().append("<tr><td>" + database[i].Artist + "</td><td>" + database[i].Title + "</td><td>" + database[i].Language + "</td><td>" + database[i].Edition + "</td><td>" + database[i].Creator +"</td> </tr>");
			    	}
			    } else {
					for (i in database) {
						$("#songtable").last().append("<tr><td>" + database[i].Artist + "</td><td>" + database[i].Title + "</td><td>" + database[i].Language + "</td><td>" + database[i].Edition + "</td><td>" + database[i].Creator +"</td> </tr>");
					}
				 }
		});
	});

	function sortByKey(array, key) {
    return array.sort(function(a, b) {
        var x = a[key]; var y = b[key];
        return ((x < y) ? -1 : ((x > y) ? 1 : 0));
    });
	}
	
	function AddSong(number) {
		$.post("api/add", JSON.stringify(database[number]));
		RefreshPlayList();
		$('#searchv2').val("added: " + database[number].Title); 
	}

	<!-- Playlist -->

	$("#playlistRefreshButton").bind ("click", function(event) {
		RefreshPlayList();
	});

	function RefreshPlayList() {
		$.get("api/getCurrentPlaylist.json", function(data){
		songlist = JSON.parse(data);
		$('#playListView').html('<li data-role="list-divider" role="heading">Upcoming songs:</li><li data-theme="c">\n');
			for (i in songlist) {
				var count = parseInt(i,10) + parseInt(1,10);
				$('#playListView').append('<li data-theme="c" data-icon="info"><a href="javascript:ViewInfo(' + i + ')" data-transition="slide"> #' + count + ' ' + songlist[i].Artist + ' - ' + songlist[i].Title + '</a></li>\n');
			}
			$('#playListView').listview('refresh');
		});
	}

$("#databaseSearchButton").bind ("click", function (event) {
	$("#autocomplete").hide();
	DoQuery();
});

$(document).keypress(function(e) {
    if(e.which == 13) {
        $("#autocomplete").hide();
	DoQuery();
    }
});

	function DoQuery() {
	$("#autocomplete").prev().find("input").attr("id", "searchv2");
	var query = $('#searchv2').val();
		
	results = $.post("api/search",query, function (data) {
	database = JSON.parse(data);
			$('#searchResultsViewer').html('<li data-role="list-divider" role="heading">Available songs:</li> <li data-theme="c">\n');
			for (i in database) {
				$('#searchResultsViewer').append('<li data-theme="c" data-icon="plus"><a href="javascript:AddSong('+ i + ')" data-transition="slide">' + database[i].Artist + ' - ' + database[i].Title + '</a></li>\n');
			}
			$('#searchResultsViewer').listview('refresh');
});
}
	function ViewInfo(songnumber) {
		$('#songinfo').html("Title: " + songlist[songnumber].Title + "<br>\nArtist: " + songlist[songnumber].Artist + 
			"<br>\nEdition: " + songlist[songnumber].Edition + "<br>\nLanguage: " + songlist[songnumber].Language + "<br>\nCreator: " 
			+ songlist[songnumber].Creator + "<br>\n" + " <div class=\"ui-grid-a\">" + 
            "<div class=\"ui-block-a\">" + 
            "<a id=\"btnremove\" data-role=\"button\" href=\"javascript:removeSong(" + songnumber +")\" data-icon=\"delete\">" +
            "Remove song </a> </div>" + 
            "<div class=\"ui-block-b\"> <a id=\"btncancel\" data-role=\"button\" href=\"#page2\" data-icon=\"back\">" + 
			"Cancel </a> </div> </div> <br> " + 
		"<div class=\"ui-grid-a\">" +
            "<div class=\"ui-block-a\">" +
            "<a id=\"btnmoveup\" data-role=\"button\" href=\"javascript:moveUp(" + songnumber +")\" data-icon=\"arrow-u\">" +
            "Move up</a></div><div class=\"ui-block-b\"> " +
            "<a id=\"btnmovedown\" data-role=\"button\" href=\"javascript:moveDown(" + songnumber +")\" data-icon=\"arrow-d\">" +
				"Move Down </a> </div> </div>");
				<!--refresh the buttons so they are rendered correctly-->
			$('#btnremove').button();
			$('#btnmoveup').button();
			$('#btnmovedown').button();
			$('#btncancel').button();
			$.mobile.changePage( "#page4", { role: "dialog" } );

	}
	function removeSong(songnumber) {
		$.post("api/remove", songnumber.toString());
		RefreshPlayList();
		$.mobile.changePage( "#page2");
	}
	function moveUp(songnumber) {
		$.post("api/moveup", songnumber.toString());
		RefreshPlayList();
		$.mobile.changePage( "#page2");
	}
	function moveDown(songnumber) {
		$.post("api/movedown", songnumber.toString());
		RefreshPlayList();
		$.mobile.changePage( "#page2");
	}

	$('#flipupdate').bind("change", function(event, ui) {
		update = !update;
	});
	
	$('#flipsortmode').bind("change", function (event, ui) {
		invertedsort = !invertedsort;
	});
	
		$("#autocomplete").on("listviewbeforefilter", function ( e, data ) {
		var $ul = $( this ),
			$input = $( data.input ),
			value = $input.val(),
			html = "";
		$ul.html("");
		if ( value && value.length > 2 ) {
			$("#autocomplete").show();
			results = $.post("api/autocomplete",$input.val(), function (data) {
				database = JSON.parse(data);
				$ul.html("<li><div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div></li>");
					for (i in database) {
					var count = parseInt(i,10) + parseInt(1,10);
					html += '<li data-theme="c" data-icon="info"><a href="javascript:AddSong(' + i + ')" data-transition="slide">' + ' ' + database[i].Artist + ' - ' + database[i].Title + '</a></li>\n';
				}
				$ul.html( html );
				$ul.listview("refresh");
				$ul.trigger("updatelayout");
			});
		}
	});	
	
		$("#autocomplete").on("click", "li", function () {
	    $("#autocomplete").hide();
	    DoQuery();
	});
	window.setInterval(function(){
		if (update) RefreshPlayList();
	}, 10000);

</script>

</body>
</html>
